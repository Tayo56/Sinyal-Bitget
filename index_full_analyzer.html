
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Single Coin Analyzer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #0e0e0e;
      color: #00BFFF;
      padding: 20px;
    }
    h1 { color: #00BFFF; }
    select, button {
      padding: 8px;
      font-size: 14px;
      margin: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: #1a1a1a;
    }
    th, td {
      padding: 10px;
      border: 1px solid #333;
      text-align: center;
    }
    th {
      background-color: #2c2c2c;
    }
  </style>
</head>
<body>
  <h1>Single Coin Analyzer (Bitget)</h1>

  <label for="symbol">Pilih Coin:</label>
  <select id="symbol">
    <option value="ETHUSDT">ETHUSDT</option>
    <option value="BTCUSDT">BTCUSDT</option>
  </select>

  <label for="interval">Timeframe:</label>
  <select id="interval">
    <option value="1m">1m</option>
    <option value="5m">5m</option>
    <option value="15m" selected>15m</option>
    <option value="30m">30m</option>
    <option value="1h">1h</option>
    <option value="4h">4h</option>
    <option value="1d">1d</option>
  </select>

  <button onclick="analyze()">Analyze</button>

  <table>
    <thead>
      <tr>
        <th>Symbol</th>
        <th>Price</th>
        <th>RSI</th>
        <th>EMA20</th>
        <th>EMA50</th>
        <th>Signal</th>
        <th>TP1</th>
        <th>TP2</th>
        <th>SL</th>
        <th>Reason</th>
      </tr>
    </thead>
    <tbody id="result">
      <tr><td colspan="10">Klik tombol Analyze untuk mulai</td></tr>
    </tbody>
  </table>

  <script>
    async function getCandleData(symbol, granularity, limit=100) {
      const map = { '1m': '1', '5m': '5', '15m': '15', '30m': '30', '1h': '60', '4h': '240', '1d': '1440' };
      const url = `https://api.bitget.com/api/v2/market/candles?symbol=${symbol}&granularity=${map[granularity]}&limit=${limit}`;
      const res = await fetch(url);
      const json = await res.json();
      return json.data.map(c => parseFloat(c[4])).reverse(); // close prices
    }

    function calcEMA(prices, period) {
      const k = 2 / (period + 1);
      let ema = prices.slice(0, period).reduce((a,b) => a + b) / period;
      for (let i = period; i < prices.length; i++) {
        ema = prices[i] * k + ema * (1 - k);
      }
      return +ema.toFixed(2);
    }

    function calcRSI(closes, period = 14) {
      let gains = 0, losses = 0;
      for (let i = 1; i <= period; i++) {
        const change = closes[i] - closes[i - 1];
        if (change > 0) gains += change;
        else losses -= change;
      }
      let avgGain = gains / period;
      let avgLoss = losses / period;

      for (let i = period + 1; i < closes.length; i++) {
        const change = closes[i] - closes[i - 1];
        avgGain = (avgGain * (period - 1) + (change > 0 ? change : 0)) / period;
        avgLoss = (avgLoss * (period - 1) + (change < 0 ? -change : 0)) / period;
      }

      const rs = avgGain / avgLoss;
      return +(100 - 100 / (1 + rs)).toFixed(2);
    }

    async function analyze() {
      const symbol = document.getElementById("symbol").value;
      const interval = document.getElementById("interval").value;
      const prices = await getCandleData(symbol, interval, 100);
      const latest = prices.at(-1).toFixed(4);
      const ema20 = calcEMA(prices, 20);
      const ema50 = calcEMA(prices, 50);
      const rsi = calcRSI(prices);

      let signal = "HOLD", reason = "";
      if (ema20 > ema50 && rsi < 70) {
        signal = "BUY";
        reason = "EMA20 > EMA50 & RSI normal";
      } else if (ema20 < ema50 && rsi > 30) {
        signal = "SELL";
        reason = "EMA20 < EMA50 & RSI turun";
      }

      const tp1 = (parseFloat(latest) * 1.01).toFixed(4);
      const tp2 = (parseFloat(latest) * 1.02).toFixed(4);
      const sl = (parseFloat(latest) * 0.99).toFixed(4);

      document.getElementById("result").innerHTML = `
        <tr>
          <td>${symbol}</td>
          <td>${latest}</td>
          <td>${rsi}</td>
          <td>${ema20}</td>
          <td>${ema50}</td>
          <td>${signal}</td>
          <td>${tp1}</td>
          <td>${tp2}</td>
          <td>${sl}</td>
          <td>${reason}</td>
        </tr>
      `;
    }
  </script>
</body>
</html>
